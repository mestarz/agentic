# GEMINI.md

## 项目概述
本项目名为 `agentic`，目前处于初始状态。这是一个由 Gemini 驱动的交互式 CLI 环境，旨在通过终端直接利用 Gemini 的能力进行软件工程任务。

## 交流规范
*   **语言偏好**：在该项目的所有对话和交互中，应尽量使用 **中文** 进行交流。

## 目录概览
本项目已建立完整的前后端分离架构：
*   **backend/**：包含 `core`（上下文引擎）和 `agent`（模型适配网关）两个 Go 服务。
*   **frontend/**：基于 React + TailwindCSS + Vite 的调试控制台。
*   **bin/**：编译后的二进制执行文件。
*   **data/**：存储会话上下文的持久化目录。

## 核心进展
*   [2026-01-16] 修复了 Web 端 Markdown 渲染及 SSE 流式传输中换行符丢失的问题。
*   [2026-01-16] 实现了基于 JSON 编码的可靠 SSE 传输协议与精准 Token 计数 (tiktoken)。
*   [2026-01-16] 引入“流程观察器”，支持 Pipeline 交互轨迹的实时监控与持久化。
*   [2026-01-16] Web 界面全面汉化，支持单条及批量会话管理。
*   [2026-01-17] 修复了 Session ID 基于秒数生成导致的高频碰撞问题，并修正了文档中关于 Token 限制单位及目录结构的描述错误。
*   [2026-01-17] **重大重构**：实现模型层彻底解耦。引入 Python LLM Gateway 服务，支持基于 Model ID 的动态适配。
*   [2026-01-17] **功能增强**：在“模型管理”中支持在线编写 Python 适配器脚本及标准厂商配置。
*   [2026-01-17] **链路追踪**：实现全链路跨服务插桩（Tracing），并在前端 Sequence Observer 中实现了基于“上下文工程”焦点的可视化展示。
*   [2026-01-17] **UI/UX 深度优化**：
    *   **时序观测仪重构**：引入 UML 激活条、生命周期竖线及侧边极简折叠栏。
    *   **全链路汉化**：实现了全界面及 Trace 动作的智能语义汉化。
    *   **时序校准**：修复了高频交互下的时间戳碰撞与流式传输合并后的耗时累加计算错误。
    *   **Endpoint 追踪**：补全了跨服务（Agent/Core/LLM）的 API 路由及内部虚拟路径展示。
*   [2026-01-17] **数据脱敏与纯净化**：对 Trace 载荷进行了深度脱敏，剥离了内部追踪字段，确保 Context 和 Prompt 展示完全符合标准 `{role, content}` 协议。
*   [2026-01-19] **Core 架构重构**：引入 `Pipeline + Pass` 架构，将上下文处理流程解耦为 `HistoryLoader`, `SystemPromptPass`, `TokenLimitPass` 等独立组件，显著提升了系统的可扩展性与可观测性。
*   [2026-01-19] **链路追踪标准化 (Trace Normalization)**：
    *   **Pipeline 归一化**：Core 内部的 Pass 执行轨迹被标准化为 `Core -> Core` 的自环 Trace，内部组件名下沉至元数据，实现了宏观视图与微观细节的完美平衡。
    *   **LLM 三段式**：重构了 LLM 交互协议，简化为 `发送 (Gateway->Provider)` -> `处理 (Provider自环)` -> `返回 (Provider->Agent)` 的清晰闭环。
*   **调试与诊断增强**：
    *   **Mermaid 导出**：系统交互观测仪支持右键一键复制 Mermaid 格式的时序图，极大便利了开发调试与文档编写。
    *   **适配器诊断**：在模型管理界面新增“即时诊断”面板，支持对配置的模型进行实时的连通性与流式响应测试。
    *   **UI/UX 修复**：彻底修复了模型管理中新建、保存、删除的状态同步逻辑及 JSON 编辑器的交互体验。
*   [2026-01-20] **上下文工程增强与架构清理**：
    *   **语义摘要 (Summarizer)**：引入 LLM 驱动的摘要 Pass，支持对长会话进行智能压缩以保留长期记忆。
    *   **Trace 折叠 (Folding)**：重构了 Trace 归一化逻辑，将微观 Pass 日志自动折叠进主节点，实现了时序图的高信噪比展示。
    *   **会话管理升级**：支持在前端对对话进行自定义重命名，增强了用户体验。
    *   **架构清理**：同步更新了 `DESIGN.md`，清理了前端冗余的翻译映射，并规范化了核心服务的代码格式。
*   [2026-01-20] **自动化评测与用例管理**：
    *   **录制与保存**：支持从对话中一键提取 User 文本并保存为 Git 跟踪的测试用例。
    *   **自动化重放 (Replay)**：实现异步对话重放状态机，支持多轮对话的一键自动化驱动。
    *   **用例编辑器**：前端新增专用视图，支持对测试步骤进行插入、删除及内容编辑。
    *   **API 归一化**：重构了 Admin API 路由解析逻辑，支持标准的资源 ID 提取与方法分发。
*   [2026-01-22] **系统可观测性与稳定性增强**：
    *   **后台日志中心**：新增全栈日志查看界面 (`LogsView`)，支持实时查看 Core、Agent、LLM Gateway 及 Frontend 的运行日志，并提供自动刷新与下载功能。
    *   **业务日志完善**：在 Core 和 Agent 服务中实现了结构化的业务日志记录，覆盖会话创建、Pipeline 执行、RAG 检索及 LLM 交互等关键节点。
    *   **Trace 全面汉化**：彻底完成了系统交互观察仪中所有动作标签的汉化，包括 Go/Python 后端直出的 Trace Action 及前端映射表。
    *   **Bug 修复**：
        *   **会话污染修复**：修复了模型适配中心的测试结果会错误出现在聊天列表中的问题。通过在 Core 持久化层引入内存缓存，确保诊断类会话 (`diag-*`) 仅驻留内存且被列表接口过滤。
        *   **Python 语法修复**：修正了 `llm-service` 中适配器管理器的缩进错误。
        *   **代理参数丢失**：修复了 Agent 服务在反向代理 Admin/Model 接口时丢失 URL 查询参数 (Query String) 的问题。
    *   **UI 布局优化**：调整了侧边导航栏布局，将“接口文档”与“系统设置”按钮移至底部，优化视觉重心。

---
*注：此文件由 Gemini AI 自动生成，作为后续交互的上下文参考。*
